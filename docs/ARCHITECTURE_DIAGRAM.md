# Diagrama da Arquitetura AWS - Contador App

```
                                    ğŸŒ INTERNET
                                         â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   Internet Gateway  â”‚
                              â”‚  (contador-app-dev) â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    Route Table      â”‚
                              â”‚ 0.0.0.0/0 â†’ IGW     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                    â”‚                    â”‚
                    â”‚                    â”‚                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           VPC            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   Subnet 0      â”‚      10.0.0.0/16         â”‚   Subnet 1      â”‚
          â”‚ 10.0.0.0/24     â”‚                          â”‚ 10.0.1.0/24     â”‚
          â”‚ (us-east-1a)    â”‚                          â”‚ (us-east-1b)    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   EC2 Instance  â”‚                          â”‚   EC2 Instance  â”‚
          â”‚ contador-app-   â”‚                          â”‚ contador-app-   â”‚
          â”‚    dev-ec2-0    â”‚                          â”‚    dev-ec2-1    â”‚
          â”‚                 â”‚                          â”‚                 â”‚
          â”‚ t2.micro        â”‚                          â”‚ t2.micro        â”‚
          â”‚ Java 17         â”‚                          â”‚ Java 17         â”‚
          â”‚ CodeDeploy Agentâ”‚                          â”‚ CodeDeploy Agentâ”‚
          â”‚ Spring Boot App â”‚                          â”‚ Spring Boot App â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                                            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   Security Group    â”‚
                              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                              â”‚ â”‚ SSH: 22         â”‚ â”‚
                              â”‚ â”‚ 203.0.113.10/32 â”‚ â”‚
                              â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
                              â”‚ â”‚ HTTP: 8080      â”‚ â”‚
                              â”‚ â”‚ 0.0.0.0/0       â”‚ â”‚
                              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

## Fluxo de Deploy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Developer     â”‚    â”‚   CodeDeploy    â”‚    â”‚   EC2 Instance  â”‚
â”‚                 â”‚    â”‚   Application   â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚                        â”‚
         â”‚ 1. Package JAR         â”‚                        â”‚
         â”‚    + scripts +         â”‚                        â”‚
         â”‚    appspec.yml         â”‚                        â”‚
         â”‚                        â”‚                        â”‚
         â”‚ 2. Upload to S3        â”‚                        â”‚
         â”‚    or GitHub           â”‚                        â”‚
         â”‚                        â”‚                        â”‚
         â”‚ 3. Create Deployment   â”‚                        â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                        â”‚
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚ 4. Download Package    â”‚
         â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚ 5. Execute Hooks:      â”‚
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚    BeforeInstall       â”‚
         â”‚                        â”‚    â”œâ”€ install_dependencies.sh
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚    ApplicationStop     â”‚
         â”‚                        â”‚    â”œâ”€ stop_application.sh
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚    AfterInstall        â”‚
         â”‚                        â”‚    â”œâ”€ install_systemd_service.sh
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚    ApplicationStart    â”‚
         â”‚                        â”‚    â”œâ”€ start_application.sh
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚    ValidateService     â”‚
         â”‚                        â”‚    â”œâ”€ validate_service.sh
         â”‚                        â”‚                        â”‚
         â”‚                        â”‚ 6. Report Success      â”‚
         â”‚                        â”‚    or Failure          â”‚
         â”‚                        â”‚                        â”‚
         â”‚ 7. Deploy Status       â”‚                        â”‚
         â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
         â”‚                        â”‚                        â”‚

```

## IAM Roles e PermissÃµes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        IAM ROLES                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Instance Role   â”‚              â”‚ Service Role    â”‚           â”‚
â”‚  â”‚ (EC2 Instances) â”‚              â”‚ (CodeDeploy)    â”‚           â”‚
â”‚  â”‚                 â”‚              â”‚                 â”‚           â”‚
â”‚  â”‚ Policies:       â”‚              â”‚ Policies:       â”‚           â”‚
â”‚  â”‚ â€¢ CodeDeploy    â”‚              â”‚ â€¢ AWSCodeDeploy â”‚           â”‚
â”‚  â”‚ â€¢ CloudWatch    â”‚              â”‚   Role          â”‚           â”‚
â”‚  â”‚ â€¢ SSM           â”‚              â”‚                 â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚           â”‚                                  â”‚                  â”‚
â”‚           â”‚                                  â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ EC2 Instance-0  â”‚              â”‚ CodeDeploy App  â”‚           â”‚
â”‚  â”‚ EC2 Instance-1  â”‚              â”‚ contador-app-   â”‚           â”‚
â”‚  â”‚                 â”‚              â”‚    dev-app      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
